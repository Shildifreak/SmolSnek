<style>
body {
	touch-action: pan-x pan-y;
	padding: 0px;
	margin: 0px;
}
#f {
	height: min(100vh, 50vw);
	width: min(200vh, 100vw);
}
.e {
	background: lightgrey;
}
.s {
	background: blue;
}
.a {
	background: red;
}
.end {
	z-index:1;
	transition-property: top left;
	transition-duration: 0.09s;
	transition-timing-function: linear;
	top: 0px;
	left: 0px;
	position: absolute;
	width: min(10vh, 5vw);
	height: min(10vh, 5vw);
	background: blue;
}

</style>
<div id="h" class="end"></div>
<div id="t" class="end"></div>
<div id="f">
</div>

<script>
var my_document = document; // alias so minifier knows its ok to rename this
var my_Math = Math;
var className = 'className';

var field = my_document.getElementById('f');
var head = my_document.getElementById('h');
var tail = my_document.getElementById('t');
var cells = field.children;
var HEIGHT = 10;
var WIDTH = 21;
var HEIGHT_TIMES_WIDTH = HEIGHT*WIDTH;

var grow = 0;
var snake = [0];
var dx = 1;
var cell, style;
//var rect;

for (n = 0; n < HEIGHT_TIMES_WIDTH; n++) {
	cell = my_document.createElement('div');
	style = cell.style;
	style.width = 100/(WIDTH-1) + '%';
	style.height = 100/HEIGHT + '%';
	style.float = 'left';
	cell[className] = ((n+1) % WIDTH) ? 'e' : 's';
	if (!((n+1) % WIDTH)) {
		style.display = 'none';
	}
	field.appendChild(cell);
}

var set_pos = (end, p) => {
	style = end.style;
	prefix = 'calc(min(10vh, 5vw) * ';
	style.left = prefix + p%(WIDTH) + ')';
	style.top = prefix + Math.floor(p/(WIDTH)) + ')';
}

var move = () => {
	my_document.cookie = my_Math.max((cells[0].innerText = my_document.cookie || 0), snake.length);
	
	x = snake[0];
	prevcell = cells[x] || cells[WIDTH-1];
	x += dx;
	cell = cells[x] || cells[WIDTH-1];
	if (cell[className] != 's') {
		if (cell[className] == 'a') {
			grow ++;
		}
		prevcell[className] = 's';
		snake.unshift(x);
		
		set_pos(head, x);
	}
	if (grow == 0) {
		if (snake.length > 1) {
			cells[snake.pop()][className] = 'e';

			set_pos(tail, snake[snake.length-1]);
		}
	}
	else {
		grow--;
	}
	
	x = my_Math.floor(my_Math.random() * HEIGHT_TIMES_WIDTH * 10);
	cell = cells[x] || {};
	if (cell[className] == 'e') {
		cell[className] = 'a';
	}
}
my_document.addEventListener('keydown', (e) => {
	dx = {37:-1,38:-WIDTH,39:1,40:WIDTH}[e.keyCode] || dx;
});

//my_document.addEventListener('pointerdown' , (e) => {
//	dx = (dx * dx != 1) ? (
//		(e.x > rect.x) ? ( 1 ) : ( -1 )
//	) : (
//		(e.y > rect.y) ? ( WIDTH ) : ( -WIDTH )
//	);
//});

my_document.addEventListener('pointerdown' , (e) => {
	dx = (
		(dx * dx == 1 ? WIDTH : -1)
		*
		(dx > 0 ? 1 : -1)
		*
		(e.x * 2 > window.innerWidth ? 1 : -1)
	);
});


var intervalId = window.setInterval(move, 100);

</script>
